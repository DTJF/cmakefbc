Installation  {#PagInstall}
============
\tableofcontents

The package includes the CMake macros and the tool cmake_fb_deps.bas.
This chapter describes two alternative ways to install the components

- Standard build (all in one go) and

- Testing Build (install CMake macros first and test installation with
  included subproject).

For both alternatives you have to prepare your system as described in
section Preparation first.


Preparation  {#SecPrepare}
===========

Before you can use (or install) the *cmakefbc* package you have to have
a working installation of some programming tools

- the [GIT version control system](http://http://git-scm.com/),
- the [CMake build system](http://www.cmake.org) and
- the [FB compiler](http://www.freebasic.net).

And you may want to install these optional packages in order to be able
to adapt the documentation

- the [Doxygen](http://www.doxygen.org/) and
- the [fb-doc package](https://github.com/dtjf/fb-doc).

\note It's beyond the scope of this guide to describe the installation
      for those programming tools. Follow the installation instructions
      in the above links.

Then use GIT to get your copy of the package and change to the source
tree

~~~{.sh}
git clone https://github.com/DTJF/cmakefbc
cd cmakefbc
~~~


Standard Build  {#SecStandard}
==============

The package is prepared to perform a standard build. This can either be done

- in-source (CMake generates auxiliary files in the source tree) or
- out-of-source (CMake generates auxiliary files in a separate folder).

In both cases the shipped CMake macros will be used to build the
subproject called cmake_fb_deps first, before both components, the
CMake macros and the tool cmake_fb_deps, get installed on your system.


In-Source build  {#SubSecInS}
---------------

Perform an in-source-build by (execute in root folder of the package)

~~~{.sh}
cmake .
make
sudo make install
~~~

The output, when executing the above command tripple, should look like
(on Debian LINUX)

~~~{.sh}
$ cd cmakefbc/

cmakefbc$ cmake .
-- Tool cmake_fb_deps not available -> no Fbc extensions!
-- Check for working Fbc compiler OK ==> /usr/local/bin/fbc (FreeBASIC 1.01.0)
-- Configuring done
-- Generating done
-- Build files have been written to: .../cmakefbc

cmakefbc$ make
Scanning dependencies of target cmake_fb_deps
[100%] Building Fbc object cmake_fb_deps/CMakeFiles/cmake_fb_deps.dir/cmake_fb_deps.bas.o
Linking Fbc executable cmake_fb_deps
[100%] Built target cmake_fb_deps

cmakefbc$ sudo make install
[sudo] password for username:
[100%] Built target cmake_fb_deps
Install the project...
-- Install configuration: ""
-- Installing: /usr/share/cmake-2.8/Modules
-- Installing: /usr/share/cmake-2.8/Modules/CMakeTestFbcCompiler.cmake
-- Installing: /usr/share/cmake-2.8/Modules/CMakeFbcCompiler.cmake.in
-- Installing: /usr/share/cmake-2.8/Modules/Platform
-- Installing: /usr/share/cmake-2.8/Modules/Platform/Windows-fbc.cmake
-- Installing: /usr/share/cmake-2.8/Modules/Platform/Linux-fbc.cmake
-- Installing: /usr/share/cmake-2.8/Modules/CMakeDetermineFbcCompiler.cmake
-- Installing: /usr/share/cmake-2.8/Modules/CMakeFbcInformation.cmake
-- Installing: /usr/local/bin/cmake_fb_deps
~~~


Out-Of-Source Build  {#SubSecOOS}
-------------------

The standard build generates the makefiles and all CMake stuff in the
source tree. In order to keep the source tree clean, you also can build
the software in a separate folder. Therefor go to the root directory of
the unpacked package, generate a new `build` directory and start the
process in that directory

~~~{.sh}
mkdir build
cd build
cmake ..
make
sudo make install
~~~

The output is similar to the above listing, but the files generated by
the build process don't polute the source tree.


Documentation Build  {#SubSecBuildDoc}
-------------------

In both cases (in-source or out-of-source build) the package is
prepared to build a documentation in form of a html tree (including the
document you're currently reading). This gets created by the [Doxygen
generator](http://www.doxygen.org/) and the [fb-doc
tool](https://github.com/dtjf/fb-doc) to extract (filter) the
documentation context from the FreeBASIC source code. Generate html
files in subfolder doc/html by executing

~~~{.sh}
make doc
~~~

You can customize the output or generate additional LaTeX or XML output
by adapting the Doxygen configuration file `Doxyfile` in the folder
`doc`.


Testing Build  {#SecBuild1}
=============

The above instructions build the subproject cmake_fb_deps first, by
using the local CMake macros in the folder `cmakefbc/cmake/Modules`.
Here's an other installation method, which installs the CMake macros
first, and then uses this fresh install to build the subproject.

Step 1 Preparation  {#SubSecStep1}
------------------

In the just unpacked package root directory, load the file
`CMakeLists.txt` in to an editor, and comment the following lines

~~~{.cmake}
# Uncomment the next two lines to perform a standard build.
#LIST(APPEND CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/cmake/Modules/")
#ADD_SUBDIRECTORY(cmake_fb_deps)
~~~

Then save the result (overriding the existend file). This removes the
subproject cmake_fb_deps from the build tree.

Step 2 CMake FB Extension Macros  {#SubSecStep2}
--------------------------------

Now use CMake to install the macros for FB programming language support
by executing the command sequence

~~~{.sh}
cd cmakefbc
cmake .
sudo make install
~~~

This command tripple changes to the project directory, creates the
Makefile by the CMake built management system and calls this Makefile
to copy the CMake macros in to the CMake installation (omit `sudo` on
non-LINUX systems).

The interaction in the terminal should look like

~~~{.sh}
$ cd cmakefbc

cmakefbc$ cmake .
-- Configuring done
-- Generating done
-- Build files have been written to: /home/user/projects/git/cmakefbc

cmakefbc$ sudo make install
Install the project...
-- Install configuration: "Release"
-- Installing: /usr/share/cmake-2.8/Modules/CMakeFbcCompiler.cmake.in
-- Installing: /usr/share/cmake-2.8/Modules/CMakeFbcInformation.cmake
-- Installing: /usr/share/cmake-2.8/Modules/CMakeTestFbcCompiler.cmake
-- Installing: /usr/share/cmake-2.8/Modules/CMakeDetermineFbcCompiler.cmake
-- Installing: /usr/share/cmake-2.8/Modules/Platform/Linux-fbc.cmake
-- Installing: /usr/share/cmake-2.8/Modules/Platform/Windows-fbc.cmake
~~~

The lines starting with the text `-- Installing:` indicate that six
configuration files have been copied to the correct location in to the
CMake Modules directory and its subfolder Platform. The CMake build
management system is now ready to address the FB language, and to
compile simple projects like the \FbDeps tool. Big projects may contain
several source files and headers and some of those source files depend
on others. In order to let CMake handle this dependencies to re-compile
only the related files, a further tool is necessary.

The tool \FbDeps helps to resolve FB dependencies in big projects with
complex source file trees. We compile its source with CMake in the next
step, and thereby test the newly installed configuration files.


Step 3 cmake_fb_deps tool  {#SubSecStep3}
-------------------------

The cmake_fb_deps tool auto-generates a CMake include file declaring
the FB source file dependencies. So it's an essential component of this
package and should get build and installed, if you intend to use the
\Tar and \Bas features to build big projects.

Once you installed the CMake FB extension macros (step 2), you can use
CMake to build the executable of this tool by executing those commands

~~~{.sh}
cd cmake_fb_deps
cmake .
make
sudo make install
~~~

to change to the subproject directory, build the Makefile by the CMake
built management system, compile and link the source code in to an
executable and finally install that executable (omit `sudo` on
non-LINUX systems).

The interaction in the terminal should look like (Debian LINUX)

~~~{.sh}
cmakefbc$ cd cmake_fb_deps

cmakefbc/cmake_fb_deps$ cmake .
-- Tool cmake_fb_deps not available -> no Fbc extensions!
-- Check for working compiler: /usr/local/bin/fbc ==> FreeBASIC 1.01.0
-- Configuring done
-- Generating done
-- Build files have been written to: /home/user/projects/git/cmakefbc/cmake_fb_deps

cmakefbc/cmake_fb_deps$ make
Scanning dependencies of target cmake_fb_deps
[100%] Building Fbc object CMakeFiles/cmake_fb_deps.dir/cmake_fb_deps.bas.o
Linking Fbc executable cmake_fb_deps
[100%] Built target cmake_fb_deps

cmakefbc/cmake_fb_deps$ sudo make install
[100%] Built target cmake_fb_deps
Install the project...
-- Install configuration: ""
-- Installing: /usr/local/bin/cmake_fb_deps
~~~

Now your CMake installation is complete. It's ready to use all features
of this package and to build complex FB projects on your system.


Uninstall  {#SecUninstall}
=========

In order to uninstall the package, remove the files listed in the
file(s) `install_manifest.txt`. Ie. on Debian LINUX (or Ubuntu) execute

~~~{.sh}
sudo xargs rm < install_manifest.txt
~~~
