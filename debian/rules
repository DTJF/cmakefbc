#!/usr/bin/make -f
# -*- makefile -*-
# Sample debian/rules that uses debhelper.
# This file was originally written by Joey Hess and Craig Small.
# As a special exception, when this file is copied by dh-make into a
# dh-make output file, you may use that output file without restriction.
# This special exception was added by Craig Small in version 0.37 of dh-make.

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

CWD := $(strip $(shell pwd))
export CMAKEMODULE_PATH=$(CWD)/cmake/Modules

clean:
	dh $@ 
	rm -rf debian/cmakefbc
	rm -rf debian/cmakefbc.*.*
	rm -rf `find . -iname Makefile -print`
	rm -rf `find . -name CMakeCache.txt -print`
	rm -rf `find . -name CMakeFiles -print`
	rm -rf `find . -name cmake_install.cmake -print`
	rm -rf `find . -name install_manifest.txt -print`
	rm -rf doxy/DoxyExtension doxy/HtmOut doxy/PdfOut 
	rm -rf doxy/html/ doxy/latex/
	rm -rf tmp

override_dh_auto_configure:
	mkdir tmp && cd tmp && cmake .. -DCMAKE_INSTALL_PREFIX:PATH=/usr -DCMAKE_MODULE_PATH=${CMAKEMODULE_PATH}

override_dh_auto_build:
	cd tmp && make && make doc_htm

override_dh_auto_install:
	cd tmp && make install DESTDIR=../debian/tmp


override_dh_shlibdeps:
	dh_shlibdeps
	echo -n "cmake:Version=" >> debian/cmakefbc.substvars
	cmake --version | sed -nre 's/^[^0-9]*(([0-9]+\.)*[0-9]+).*/\1/p' | cut -d. -f1-2 >> debian/cmakefbc.substvars


%:
	dh $@ 
